var t=function(t){return null==t},e=function(t){return Object.getPrototypeOf(t)===Object.prototype},r=function(s,i){return Object.entries(s).forEach(function(n){var o=n[0],u=n[1];t(u)||!e(u)&&!Array.isArray(u)||(s[o]=r(u,i))}),new Proxy(s,{set:function(s,n,o){return!t(o)&&e(o)&&(o=r(o,i)),i.set(s,n,s[n]=o),!0}})},s={stores:{},persisted:[],subscribers:[],disableReactivity:!1,start:function(){try{var t=this;return Promise.resolve(new Promise(function(t){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",t):t()})).then(function(){t.attach(),document.addEventListener("turbolinks:render",t.attach),t.stores=r(t.stores,{set:function(){t.disableReactivity||(t.updateSubscribers(),t.disableReactivity=!0,t.persisted.forEach(t.updateLocalStorage.bind(t)),t.disableReactivity=!1)}})})}catch(t){return Promise.reject(t)}},attach:function(){if(!window.Alpine)throw new Error("[Spruce] You must be using Alpine >= 2.5.0 to use Spruce.");var t=this;window.Alpine.addMagicProperty("store",function(e){return t.subscribe(e),t.stores})},store:function(t,e,r){return void 0===r&&(r=!1),r&&(this.stores[t]=this.retrieveFromLocalStorage(t),this.persisted.push(t)),this.stores[t]||(this.stores[t]=e),this.stores[t]},reset:function(t,e){this.stores[t]=e},subscribe:function(t){return this.subscribers.includes(t)||this.subscribers.push(t),this.stores},updateSubscribers:function(){this.subscribers.filter(function(t){return!!t.__x}).forEach(function(t){t.__x.updateElements(t)})},retrieveFromLocalStorage:function(t){return JSON.parse(window.localStorage.getItem("__spruce:"+t))||null},updateLocalStorage:function(t){window.localStorage.setItem("__spruce:"+t,JSON.stringify(this.store(t)))},persist:function(t){this.persisted.includes(t)||this.persisted.push(t),this.updateLocalStorage(t)},dontPersist:function(t){this.persisted=this.persisted.filter(function(e){return t!==e})}},i=window.deferLoadingAlpine||function(t){t()};window.deferLoadingAlpine=function(t){window.Spruce=s,window.Spruce.start(),i(t)},module.exports=s;
//# sourceMappingURL=spruce.js.map
