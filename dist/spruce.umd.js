!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.spruce=t()}(this,function(){var e=function(e){return null==e},t=function(e){return Object.getPrototypeOf(e)===Object.prototype},n=function(r,s){return Object.entries(r).forEach(function(i){var o=i[0],u=i[1];e(u)||!t(u)&&!Array.isArray(u)||(r[o]=n(u,s))}),new Proxy(r,{set:function(r,i,o){return!e(o)&&t(o)&&(o=n(o,s)),s.set(r,i,r[i]=o),!0}})},r={stores:{},subscribers:[],start:function(){try{var e=this;return Promise.resolve(new Promise(function(e){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",e):e()})).then(function(){e.attach(),document.addEventListener("turbolinks:render",e.attach),e.stores=n(e.stores,{set:e.updateSubscribers.bind(e)})})}catch(e){return Promise.reject(e)}},attach:function(){if(!window.Alpine)throw new Error("[Spruce] You must be using Alpine >= 2.5.0 to use Spruce.");var e=this;window.Alpine.addMagicProperty("store",function(t){return e.subscribe(t),e.stores})},store:function(e,t){return this.stores[e]||(this.stores[e]=t),this.stores[e]},reset:function(e,t){this.stores[e]=t},subscribe:function(e){return this.subscribers.includes(e)||this.subscribers.push(e),this.stores},updateSubscribers:function(){this.subscribers.filter(function(e){return!!e.__x}).forEach(function(e){e.__x.updateElements(e)})}},s=window.deferLoadingAlpine||function(e){e()};return window.deferLoadingAlpine=function(e){window.Spruce=r,window.Spruce.start(),s(e)},r});
//# sourceMappingURL=spruce.umd.js.map
